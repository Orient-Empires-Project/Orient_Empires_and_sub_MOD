
#########################
# Triggers for Titles
#########################

# has_mythical_founder_trigger - Does the title have a mythical or semi-mythical founder?


has_mythical_founder_trigger = {
	OR = {
		AND = { # Charles Martell (?)
			OR = {
				this = title:k_france
				this = title:e_france
			}
			current_date > 1000.1.1
		}
		OR = { # Alexander		
			this = title:k_thessalonika
			this = title:k_hellas
			this = title:k_egypt
			AND = {
				OR = {
					this = title:k_persia
					this = title:e_persia
				}
				NOR = {
					root.faith.religion = religion:islam_religion
					root.faith.religion = religion:zoroastrianism_religion
				}
			}
			this = title:k_anatolia
		}
		this = title:k_poland # Lech
		this = title:k_bohemia # Czech
		OR = { # Rus
			this = title:k_white_rus
			this = title:k_ruthenia
			this = title:e_russia
		}
		OR = { # Arthur
			this = title:k_england
			this = title:e_britannia
		}
		AND = {
			OR = { # Belisarius
				this = title:k_italy
				this = title:k_romagna
				this = title:k_sardinia
				this = title:k_naples
				this = title:e_italy
			}
			root.faith = faith:orthodox
		}
		OR = { # Romulus
			this = title:k_italy
			this = title:k_romagna
			this = title:k_sardinia
			this = title:e_italy
			this = title:e_roman_empire
		}
		OR = { # Ardashir
			this = title:k_persia
			this = title:e_persia
		}
		AND = { # Pharaohs
			this = title:k_egypt
			NOT = { root.faith.religion = religion:islam_religion }
		}
		AND = { # Visigothic Kings
			OR = {
				this = title:k_castille
				this = title:k_aragon
				this = title:k_navarra
				this = title:k_andalusia
				this = title:k_portugal
				this = title:e_spain
			}
			NOT = { root.faith.religion = religion:islam_religion }
		}
		AND = { # Abd al-Rahman
			OR = {
				this = title:k_castille
				this = title:k_aragon
				this = title:k_navarra
				this = title:k_andalusia
				this = title:k_portugal
				this = title:e_spain
			}
			root.faith.religion = religion:islam_religion
		}
		AND = { # Zenobia
			OR = {
				this = title:k_syria
				this = title:k_mesopotamia
			}
			NOT = { root.faith.religion = religion:islam_religion }
		}
	}
}

is_rightful_liege_of_trigger = {
	OR = {
		# Most vassals only consider their liege to be Rightful if their liege possesses their primary title's immediate De Jure liege title.
		$LIEGE$ = {
			any_held_title = {
				save_temporary_scope_as = this_title
					$VASSAL$.primary_title = {
						target_is_de_jure_liege_or_above = scope:this_title
					}
			}
		}
		# There is a bonus exception for Duke-tier vassals of Emperors, however — as long as their primary Duchy title belongs inside of their liege's Empire title, they still consider their liege to be Rightful.
		trigger_if = {
			limit = {
				$LIEGE$.highest_held_title_tier = tier_empire
				$VASSAL$.highest_held_title_tier = tier_duchy 
			}
			$LIEGE$ = {
				any_held_title = {
					tier = tier_empire
					save_temporary_scope_as = this_title
					$VASSAL$.primary_title = {
						target_is_de_jure_liege_or_above = scope:this_title
					}
				}
			}
		}
	}
}

has_too_many_held_duchies_trigger = {
	highest_held_title_tier >= tier_kingdom
	OR = {
		AND = {
			NOT = { culture = { has_innovation = innovation_centralization_of_authority } }
			any_held_title = {
				count >= 3
				title_counts_towards_too_many_duchies_trigger = yes
			}
		}
		AND = {
			culture = { has_innovation = innovation_centralization_of_authority }
			any_held_title = {
				count >= 5
				title_counts_towards_too_many_duchies_trigger = yes
			}
		}
	}
}

title_counts_towards_too_many_duchies_trigger = {
	tier = tier_duchy
	is_titular = no
}

# this = title
# VASSAL = Vassal to check tier against
# LIEGE = Liege of vassal
title_lost_from_realm_on_foreign_ruler_succession_trigger = {
	tier > $VASSAL$.highest_held_title_tier
	exists = holder  # Ignoring titles that will be created by confederate partition, cause that be magic and unlikely to make a warning anyway
	holder = {
		NOR = {
			this = $LIEGE$
			target_is_liege_or_above = $LIEGE$
		}
	}
}
