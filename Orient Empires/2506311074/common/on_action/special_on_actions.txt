on_game_start_after_lobby = {
	on_actions = {
		oe_info_effects
		story_on_start
		#destroy_void_title
	}
}
oe_info_effects = {
	effect = {
		every_player = {
			trigger_event = { 
				id = oe_info.001
				days = 1
			}
		}
	}
}

destroy_void_title = {
	effect = {
		if = { #公国头衔
			limit = {
				exists = title:e_celestia.holder
			}
			title:e_celestia.holder = {
				every_held_title = {
					limit = {
						tier = tier_duchy
						is_landless_type_title = no
						is_oe_noble_family_title = no
						title_capital_county = {
							OR = {
								NOT = { holder = root }
								NOT = { holder.top_liege = root }
							}
						}
					}
					holder = {
						destroy_title = prev
					}
				}			
			}
		}
	}
}




# root = character gaining vassal
# scope:vassal = vassal being gained
# scope:old_liege = the previous liege of the vassal.

on_natural_death_second_chance = {
	on_actions = { on_shihao_effect }
}

on_death = {
	on_actions = { 
		on_shihao_effect
	}
}

on_shihao_effect = {
	trigger = {
		NOR = {
			has_trait = miaohao_trait_gaozu
			has_trait = miaohao_trait_taizu
			has_trait = miaohao_trait_shizu
		}			
		OR = {			
			AND = {
				is_oe_imperial_court_trigger = yes
				OR = {
					culture = { has_cultural_pillar = heritage_chinese }
					culture = { has_cultural_pillar = heritage_mongolic }
					culture = { has_cultural_pillar = heritage_turkic }
					culture = { has_cultural_pillar = heritage_iranian }
					culture = { has_cultural_pillar = heritage_nanman }
					culture = { has_cultural_pillar = heritage_tunguse }
					culture = { has_cultural_pillar = heritage_goryeo }
					culture = { has_cultural_pillar = heritage_yues }
				}
				primary_title.tier >= tier_kingdom
				government_has_flag = government_is_celestial
			}	
			has_trait = shanghuang
		}
		NOR = {
			primary_title = title:k_guiyi
		}
	}
	effect = {
		save_scope_as = death_man

		#primary_heir = {
			#if = {
				#limit = { is_ai = no }
				#trigger_event = {
					#id = nianhao.1
					#days = 2
				#}
			#}
		#}
		
		if = {
			limit = {
				exists = primary_heir
				primary_title.tier > tier_kingdom
				OR = {
					dynasty = dynasty:longxi_li_dyn #李唐
					dynasty = dynasty:1000049852 #沙唐
				}
			}
			primary_heir = {
				trigger_event = {
					days = 7
					id = miaohao.1  #选定庙号
				}
				trigger_event = {
					days = 7
					id = shihao.8  #选定唐式谥号	
				}
			}		
		}
		else_if = {
			limit = {
				exists = primary_heir
				primary_title.tier > tier_kingdom
			}
			primary_heir = {
				trigger_event = {
					days = 7
					id = miaohao.1  #选定庙号
				}
				trigger_event = {
					days = 10
					id = shihao.9  #选定单字谥号
				}
			}
		}
		else_if = {
			limit = {
				exists = primary_heir
				primary_title.tier = tier_kingdom
			}
			primary_heir = {
				trigger_event = {
					days = 10
					id = shihao.9  #选定单字谥号
				}
			}
		}
		else_if = {
			limit = { 
				has_trait = shanghuang
			}
			top_liege = {
				save_scope_as = heir
				trigger_event = {
					days = 7
					id = miaohao.1  #选定庙号
				}
				if = {
					limit = {
						OR = {
							dynasty = dynasty:longxi_li_dyn #李唐
							dynasty = dynasty:1000049852 #沙唐
						}
					}
					trigger_event = {
						days = 10
						id = shihao.8  #选定唐式谥号	
					}
				}
				else = {
					trigger_event = {
						days = 10
						id = shihao.9  #选定谥号	
					}
				}
			}	
		}
		else_if = {
			limit = { 
				scope:death_man = {			
					OR = {
						has_trait = hoo
						has_trait = joko
					} 
				}
			}
			title:d_gosho.holder = {
				save_scope_as = heir
				trigger_event = {
					days = 7
					id = miaohao.1  #选定庙号
				}
				trigger_event = {
					days = 10
					id = shihao.8  #选定谥号	
				}
			}		
		}
		
	}
}

on_title_gain = {
	on_actions = {
		guohao_effects
		kingdom_guohao_effects
		yamato_on_title_gain_effects
		zunhao_effects
		story_title_gain_effects
	}
}

guohao_effects = {
	effect = {
		if = { ## 改国号##
			limit = {
				is_ai = yes
				exists = capital_province
				scope:title = title:e_celestia
				OR = {
					AND = {
						exists = scope:previous_holder
						NOR = {					
							scope:transfer_type = flag:inheritance
							root.house = scope:previous_holder.house
						}
					}
					scope:transfer_type = flag:created
				}
			}
			save_scope_as = new_ruler
			if = {
				limit = {
					father = { is_alive = no }
				}
				father = { 
					add_trait = miaohao_trait_gaozu 
				}
			}
			#add_trait = founding_monarch
			if = {
				limit = {
					NOT = { house = { has_house_modifier = cust_dynasty } }
				}
				house = { add_house_modifier = cust_dynasty }
			}

			####复国恢复国号

			if = {
				limit = {
					royal_members_trigger = yes ##前皇族
				}
				if = {
					limit = {
						house = {
							has_house_modifier = e_tang #唐皇族
						}
					}
					title:e_celestia = { set_title_name = e_tang }
					title:e_celestia = { set_coa = title:e_tang }
					title:e_celestia = { set_color_from_title = title:k_guiyi }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_liang #梁皇族
						}
					}
					title:e_celestia = { set_title_name = e_liang }
					title:e_celestia = { set_coa = title:k_liang }
					title:e_celestia = { set_color_from_title = title:k_liang }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_song #宋皇族
						}
					}
					title:e_celestia = { set_title_name = e_song }
					title:e_celestia = { set_coa = title:d_biansong }
					title:e_celestia = { set_color_from_title = title:e_song }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_grand_liao #大辽皇族
						}
					}
					title:e_celestia = { set_title_name = e_grand_liao }
					title:e_celestia = { set_coa = title:k_liao }
					title:e_celestia = { set_color_from_title = title:k_liao }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_zhao #赵皇族
						}
					}
					title:e_celestia = { set_title_name = e_zhao }
					title:e_celestia = { set_coa = title:e_zhao }
					title:e_celestia = { set_color_from_title = title:e_zhao }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_yan #燕皇族
						}
					}
					title:e_celestia = { set_title_name = k_yan }
					title:e_celestia = { set_coa = title:k_yan }
					title:e_celestia = { set_color_from_title = title:k_yan }
	
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_wei #魏皇族
						}
					}
					title:e_celestia = { set_title_name = k_wei }
					title:e_celestia = { set_coa = title:k_wei }
					title:e_celestia = { set_color_from_title = title:k_wei }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_tengri #代皇族
						}
					}
					title:e_celestia = { set_title_name = k_tengri }
					title:e_celestia = { set_coa = title:k_tengri }
					title:e_celestia = { set_color_from_title = title:k_tengri }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_jin #晋皇族
						}
					}
					title:e_celestia = { set_title_name = k_jin }
					title:e_celestia = { set_coa = title:k_jin }
					title:e_celestia = { set_color_from_title = title:k_jin }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_xia_east #夏皇族
						}
					}
					title:e_celestia = { set_title_name = k_xia_east }
					title:e_celestia = { set_coa = title:k_xia_east }
					title:e_celestia = { set_color_from_title = title:k_xia_east }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_longxi #岐皇族
						}
					}
					title:e_celestia = { set_title_name = k_longxi }
					title:e_celestia = { set_coa = title:k_longxi }
					title:e_celestia = { set_color_from_title = title:k_longxi }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_qin #秦皇族
						}
					}
					title:e_celestia = { set_title_name = k_qin }
					title:e_celestia = { set_coa = title:k_qin }
					title:e_celestia = { set_color_from_title = title:k_qin }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_shu #蜀皇族
						}
					}
					title:e_celestia = { set_title_name = e_han }
					title:e_celestia = { set_coa = title:e_han }
					title:e_celestia = { set_color_from_title = title:k_shu }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_zhou #周皇族
						}
					}
					title:e_celestia = { set_title_name = k_zhou }
					title:e_celestia = { set_coa = title:k_zhou }
					title:e_celestia = { set_color_from_title = title:k_zhou }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_qi #齐皇族
						}
					}
					title:e_celestia = { set_title_name = k_qi }
					title:e_celestia = { set_coa = title:k_qi }
					title:e_celestia = { set_color_from_title = title:k_qi }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_chu #楚皇族
						}
					}
					title:e_celestia = { set_title_name = k_chu }
					title:e_celestia = { set_coa = title:k_chu }
					title:e_celestia = { set_color_from_title = title:k_chu }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_wu #吴皇族
						}
					}
					title:e_celestia = { set_title_name = k_wu }
					title:e_celestia = { set_coa = title:k_wu }
					title:e_celestia = { set_color_from_title = title:k_wu }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_wuyue #吴越皇族
						}
					}
					title:e_celestia = { set_title_name = e_wuyue }
					title:e_celestia = { set_coa = title:k_yue }
					title:e_celestia = { set_color_from_title = title:k_yue }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_qian #大黔皇族
						}
					}
					title:e_celestia = { set_title_name = e_qian }
					title:e_celestia = { set_coa = title:k_qianzhong }
					title:e_celestia = { set_color_from_title = title:k_qianzhong }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_nanyue #南越皇族
						}
					}
					title:e_celestia = { set_title_name = k_nanyue }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_viet #大越皇族
						}
					}
					title:e_celestia = { set_title_name = e_viet }
					title:e_celestia = { set_coa = title:k_annan }
					title:e_celestia = { set_color_from_title = title:k_annan }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_dali #大礼皇族
						}
					}
					title:e_celestia = { set_title_name = e_dali }
					title:e_celestia = { set_coa = title:k_nanzhong }
					title:e_celestia = { set_color_from_title = title:k_nanzhong }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_lanxang #大寮皇族
						}
					}
					title:e_celestia = { set_title_name = e_lanxang }
					title:e_celestia = { set_coa = title:k_lanxang }
					title:e_celestia = { set_color_from_title = title:k_lanxang }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_goryeo #高丽皇族
						}
					}
					title:e_celestia = { set_title_name = k_goryeo }
					title:e_celestia = { set_coa = title:k_goryeo }
					title:e_celestia = { set_color_from_title = title:k_goryeo }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_hexi #凉皇族
						}
					}
					title:e_celestia = { set_title_name = e_hexi }
					title:e_celestia = { set_coa = title:k_xia }
					title:e_celestia = { set_color_from_title = title:k_xia }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_yuan
						}
					}
					title:e_celestia = { set_title_name = e_yuan }
					title:e_celestia = { set_coa = title:k_jubu }
					title:e_celestia = { set_color_from_title = title:k_jubu }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_zhou
						}
					}
					title:e_celestia = { set_title_name = e_zhou }
					title:e_celestia = { set_coa = title:d_heluo }
					title:e_celestia = { set_color_from_title = title:d_heluo }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_zheng
						}
					}
					title:e_celestia = { set_title_name = e_zheng }
					title:e_celestia = { set_coa = title:d_zhenghua }
					title:e_celestia = { set_color_from_title = title:d_zhenghua }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_chen
						}
					}
					title:e_celestia = { set_title_name = e_chen }
					title:e_celestia = { set_coa = title:d_chenxu }
					title:e_celestia = { set_color_from_title = title:d_chenxu }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_song #宋皇族
						}
					}
					title:e_celestia = { set_title_name = e_song }
					title:e_celestia = { set_coa = title:d_biansong }
					title:e_celestia = { set_color_from_title = title:d_biansong }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_min #闽皇族
						}
					}
					title:e_celestia = { set_title_name = e_min }
					title:e_celestia = { set_coa = title:d_fujian }
					title:e_celestia = { set_color_from_title = title:d_fujian }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_lu #鲁皇族
						}
					}
					title:e_celestia = { set_title_name = e_lu }
					title:e_celestia = { set_coa = title:d_taining }
					title:e_celestia = { set_color_from_title = title:d_taining }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_weei #卫皇族
						}
					}
					title:e_celestia = { set_title_name = e_weei }
					title:e_celestia = { set_coa = title:d_xiangwei }
					title:e_celestia = { set_color_from_title = title:d_xiangwei }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_zhongshan #中山皇族
						}
					}
					title:e_celestia = { set_title_name = e_zhongshan }
					title:e_celestia = { set_coa = title:d_yiding }
					title:e_celestia = { set_color_from_title = title:d_yiding }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_liao #辽皇族
						}
					}
					title:e_celestia = { set_title_name = k_liao }
					title:e_celestia = { set_coa = title:k_liao }
					title:e_celestia = { set_color_from_title = title:k_liao }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_qiang #大羌皇族
						}
					}
					title:e_celestia = { set_title_name = e_qiang }
					title:e_celestia = { set_coa = title:k_xia }
					title:e_celestia = { set_color_from_title = title:k_xia }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_han #汉皇族
						}
					}
					title:e_celestia = { set_title_name = e_han }
					title:e_celestia = { set_coa = title:e_han }
					title:e_celestia = { set_color_from_title = title:e_han }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_sui #隋皇族
						}
					}
					title:e_celestia = { set_title_name = e_sui }
					title:e_celestia = { set_coa = title:d_jingxiang }
					title:e_celestia = { set_color_from_title = title:d_jingxiang }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_cao #曹皇族
						}
					}
					title:e_celestia = { set_title_name = k_wei }
					title:e_celestia = { set_coa = title:d_pucao }
					title:e_celestia = { set_color_from_title = title:d_pucao }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_xuu #徐皇族
						}
					}
					title:e_celestia = { set_title_name = e_xuu }
					title:e_celestia = { set_coa = title:d_xusi }
					title:e_celestia = { set_color_from_title = title:d_xusi }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_qi #齐皇族
						}
					}
					title:e_celestia = { set_title_name = k_qi }
					title:e_celestia = { set_coa = title:k_qi }
					title:e_celestia = { set_color_from_title = title:d_ziqing }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = k_wu #吴皇族
						}
					}
					title:e_celestia = { set_title_name = k_wu }
					title:e_celestia = { set_coa = title:k_wu }
					title:e_celestia = { set_color_from_title = title:d_huainan }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_wuyue #吴越皇族
						}
					}
					title:e_celestia = { set_title_name = e_wuyue }
					title:e_celestia = { set_coa = title:d_zhenhai }
					title:e_celestia = { set_color_from_title = title:k_yue }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = e_gan #赣皇族
						}
					}
					title:e_celestia = { set_title_name = e_gan }
					title:e_celestia = { set_coa = title:d_jiangxi }
					title:e_celestia = { set_color_from_title = title:d_jiangxi }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = cn_pu #雒皇族
						}
					}
					title:e_celestia = { set_title_name = cn_pu }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
				else_if = {
					limit = {
						house = {
							has_house_modifier = cn_xie
						}
					}
					title:e_celestia = { set_title_name = cn_xie }
					title:e_celestia = { set_coa = title:k_qianzhong }
					title:e_celestia = { set_color_from_title = title:k_qianzhong }
				}
			}
			#非皇族开国
			else = {
				if = {
					limit = {
						OR = {
							has_title = title:e_tang
							dynasty = dynasty:1000049851
							dynasty = dynasty:1000049852
							dynasty = dynasty:longxi_li_dyn
						}
					}
					house = {
						add_house_modifier = new_e_tang #唐皇族
					}
					title:e_celestia = { set_title_name = e_tang }
					title:e_celestia = { set_coa = title:e_tang }
					title:e_celestia = { set_color_from_title = title:e_tang }
				}
				if = {
					limit = {
						OR = { 
							has_title = title:k_han
							has_title = title:k_guiyi
							has_title = title:e_han
						}
					}
					house = {
						add_house_modifier = new_e_han #汉皇族
					}
					title:e_celestia = { set_title_name = e_han }
					title:e_celestia = { set_coa = title:e_han }
					title:e_celestia = { set_color_from_title = title:e_han }
				}
				else_if = {
					limit = {
						OR = {
							AND = {
								has_title = title:k_liang
								root.capital_province.kingdom = title:k_liang
								NOR = {
									root.capital_province.duchy = title:d_weibo
									root.capital_province.duchy = title:d_xiangwei
									root.capital_province.county = title:c_songzhou_song
								}
							}
							dynasty = dynasty:1000048157 #Zhu
						}
					}
					house = {
						add_house_modifier = new_e_liang #梁皇族
					}
					title:e_celestia = { set_title_name = e_liang }
					title:e_celestia = { set_coa = title:k_liang }
					title:e_celestia = { set_color_from_title = title:k_liang }
				}
				else_if = {
					limit = {
						has_title = title:e_song
					}
					house = {
						add_house_modifier = new_e_song #宋皇族
					}
					title:e_celestia = { set_title_name = e_song }
					title:e_celestia = { set_coa = title:d_biansong }
					title:e_celestia = { set_color_from_title = title:e_song }
				}
				else_if = {
					limit = {
						dynasty = dynasty:hongnong_yang_dyn
					}
					house = {
						add_house_modifier = new_e_sui #隋皇族
					}
					title:e_celestia = { set_title_name = e_sui }
					title:e_celestia = { set_coa = title:d_jingxiang }
					title:e_celestia = { set_color_from_title = title:d_jingxiang }
				}
				else_if = {
					limit = {
						root.capital_province.duchy = title:d_zhenghua
					}
					house = {
						add_house_modifier = new_e_zheng
					}
					title:e_celestia = { set_title_name = e_zheng }
					title:e_celestia = { set_coa = title:d_zhenghua }
					title:e_celestia = { set_color_from_title = title:d_zhenghua }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_chenxu
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_chenxu
							}
						}
					}
					house = {
						add_house_modifier = new_e_chen
					}
					title:e_celestia = { set_title_name = e_chen }
					title:e_celestia = { set_coa = title:d_chenxu }
					title:e_celestia = { set_color_from_title = title:d_chenxu }
				}
				if = {
					limit = {
						OR = {
							#has_title = title:d_dianqian
							dynasty = dynasty:zhuojun_zhao_dyn
							root = character:217721
							#root = character:1401294
							#root = character:1401292
							root.capital_province.duchy = title:d_biansong
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_biansong
							}
						}
					}
					house = {
						add_house_modifier = new_e_song #宋皇族
					}
					title:e_celestia = { set_title_name = e_song }
					title:e_celestia = { set_coa = title:d_biansong }
					title:e_celestia = { set_color_from_title = title:d_biansong }
				}
				else_if = {
					limit = {
						NOT = { 
							has_title = title:k_liang
						}
						OR = {
							root.capital_province.county = title:c_songzhou_song
							AND = {
								NOT = { exists = capital_province }
								root.location.county = title:c_songzhou_song
							}
						}
					}
					house = {
						add_house_modifier = new_e_song #宋皇族
					}
					title:e_celestia = { set_title_name = e_song }
					title:e_celestia = { set_coa = title:d_biansong }
					title:e_celestia = { set_color_from_title = title:d_biansong }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_fujian
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_fujian
							}
						}
					}
					house = {
						add_house_modifier = new_e_min #闽皇族
					}
					title:e_celestia = { set_title_name = e_min }
					title:e_celestia = { set_coa = title:d_fujian }
					title:e_celestia = { set_color_from_title = title:d_fujian }
				}
				else_if = {
					limit = {
						NOT = { 
							has_title = title:k_qi
						}
						OR = {
							root.capital_province.duchy = title:d_taining
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_taining
							}
							has_title = title:d_confucius
						}	
					}
					house = {
						add_house_modifier = new_e_lu #鲁皇族
					}
					title:e_celestia = { set_title_name = e_lu }
					title:e_celestia = { set_coa = title:d_taining }
					title:e_celestia = { set_color_from_title = title:d_taining }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_xiangwei
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_xiangwei
							}
						}
					}
					house = {
						add_house_modifier = new_e_weei #卫皇族
					}
					title:e_celestia = { set_title_name = e_weei }
					title:e_celestia = { set_coa = title:d_xiangwei }
					title:e_celestia = { set_color_from_title = title:d_xiangwei }
				}
				else_if = {
					limit = {
						NOT = { 
							has_title = title:k_zhao
						}
						OR = {
							root.capital_province.duchy = title:d_yiding
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_yiding
							}
						}
					}
					house = {
						add_house_modifier = new_e_zhongshan #中山皇族
					}
					title:e_celestia = { set_title_name = e_zhongshan }
					title:e_celestia = { set_coa = title:d_yiding }
					title:e_celestia = { set_color_from_title = title:d_yiding }
				}
				else_if = {
					limit = {	
						OR = {
							root.capital_province.duchy = title:d_hedong
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_hedong
							}
							has_title = title:d_hedong 
						}
						NOT = { has_title = title:k_jin }
					}
					house = {
						add_house_modifier = new_e_tang #唐皇族
					}
					title:e_celestia = { set_title_name = e_tang }
					title:e_celestia = { set_coa = title:d_hedong }
					title:e_celestia = { set_color_from_title = title:e_tang }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_zelu
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_zelu
							}
						}
					}
					house = {
						add_house_modifier = new_k_zhao #赵皇族
					}
					title:e_celestia = { set_title_name = e_zhao }
					title:e_celestia = { set_coa = title:e_zhao }
					title:e_celestia = { set_color_from_title = title:e_zhao }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_khitan
					}
					house = {
						add_house_modifier = new_e_grand_liao #大辽皇族
					}
					title:e_celestia = { set_title_name = e_grand_liao }
					title:e_celestia = { set_coa = title:k_liao }
					title:e_celestia = { set_color_from_title = title:k_liao }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_zhao
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_zhao
							}
							has_title = title:k_zhao
						}
					}
					house = {
						add_house_modifier = new_k_zhao #赵皇族
					}
					title:e_celestia = { set_title_name = e_zhao }
					title:e_celestia = { set_coa = title:e_zhao }
					title:e_celestia = { set_color_from_title = title:e_zhao }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_yan
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_yan
							}
							has_title = title:d_youzhou
						}
					}
					house = {
						add_house_modifier = new_k_yan #燕皇族
					}
					title:e_celestia = { set_title_name = k_yan }
					title:e_celestia = { set_coa = title:k_yan }
					title:e_celestia = { set_color_from_title = title:k_yan }
	
				}
				else_if = {
					limit = {					
						OR = {
							root.capital_province.duchy = title:d_weibo
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_weibo
							}
						}
					}
					house = {
						add_house_modifier = new_k_wei #魏皇族
					}
					title:e_celestia = { set_title_name = k_wei }
					title:e_celestia = { set_coa = title:k_wei }
					title:e_celestia = { set_color_from_title = title:k_wei }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_tengri
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_tengri
							}
						}
					}
					house = {
						add_house_modifier = new_k_tengri #代皇族
					}
					title:e_celestia = { set_title_name = k_tengri }
					title:e_celestia = { set_coa = title:k_tengri }
					title:e_celestia = { set_color_from_title = title:k_tengri }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_jin
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_jin
							}
							has_title = title:k_jin
						}
						NOR = {
							dynasty = dynasty:1000049851
							dynasty = dynasty:1000049852
						}
					}
					house = {
						add_house_modifier = new_k_jin #晋皇族
					}
					title:e_celestia = { set_title_name = k_jin }
					title:e_celestia = { set_coa = title:k_jin }
					title:e_celestia = { set_color_from_title = title:k_jin }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_xia_east
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_xia_east
							}
						}
					}
					house = {
						add_house_modifier = new_k_xia_east #夏皇族
					}
					title:e_celestia = { set_title_name = k_xia_east }
					title:e_celestia = { set_coa = title:k_xia_east }
					title:e_celestia = { set_color_from_title = title:k_xia_east }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_longxi
					}
					house = {
						add_house_modifier = new_k_longxi #岐皇族
					}
					title:e_celestia = { set_title_name = k_qin }
					title:e_celestia = { set_coa = title:k_qin }
					title:e_celestia = { set_color_from_title = title:k_qin }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_qin
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_qin
							}
						}
					}
					house = {
						add_house_modifier = new_k_qin #秦皇族
					}
					title:e_celestia = { set_title_name = k_qin }
					title:e_celestia = { set_coa = title:k_qin }
					title:e_celestia = { set_color_from_title = title:k_qin }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_shu
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_shu
							}
						}
					}
					house = {
						add_house_modifier = new_k_shu #蜀皇族
					}
					title:e_celestia = { set_title_name = e_han }
					title:e_celestia = { set_coa = title:e_han }
					title:e_celestia = { set_color_from_title = title:e_han }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_zhou
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_zhou
							}
						}
						#has_title = title:k_zhou
					}
					house = {
						add_house_modifier = new_k_zhou #周皇族
					}
					title:e_celestia = { set_title_name = k_zhou }
					title:e_celestia = { set_coa = title:k_zhou }
					title:e_celestia = { set_color_from_title = title:k_zhou }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_qi
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_qi
							}
						}
					}
					house = {
						add_house_modifier = new_k_qi #齐皇族
					}
					title:e_celestia = { set_title_name = k_qi }
					title:e_celestia = { set_coa = title:k_qi }
					title:e_celestia = { set_color_from_title = title:k_qi }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_chu
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_chu
							}
						}
						NOR = {
							root.capital_province.duchy = title:d_jingxiang
						}
					}
					house = {
						add_house_modifier = new_k_chu #楚皇族
					}
					title:e_celestia = { set_title_name = k_chu }
					title:e_celestia = { set_coa = title:k_chu }
					title:e_celestia = { set_color_from_title = title:k_chu }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_wu
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_wu
							}
						}					
						NOR = {
							root.capital_province.duchy = title:d_huaixi
							root.capital_province.duchy = title:d_huainan
						}
					}
					house = {
						add_house_modifier = new_k_wu #吴皇族
					}
					title:e_celestia = { set_title_name = k_wu }
					title:e_celestia = { set_coa = title:k_wu }
					title:e_celestia = { set_color_from_title = title:k_wu }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.kingdom = title:k_yue
							AND = {
								NOT = { exists = capital_province }
								root.location.kingdom = title:k_yue
							}
						}
						NOT = { root.capital_province.duchy = title:d_fujian }
					}
					house = {
						add_house_modifier = new_e_wuyue #吴越皇族
					}
					title:e_celestia = { set_title_name = e_wuyue }
					title:e_celestia = { set_coa = title:k_yue }
					title:e_celestia = { set_color_from_title = title:k_yue }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_qianzhong
					}
					house = {
						add_house_modifier = new_e_qian #大黔皇族
					}
					title:e_celestia = { set_title_name = e_qian }
					title:e_celestia = { set_coa = title:k_qianzhong }
					title:e_celestia = { set_color_from_title = title:k_qianzhong }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_nanyue
					}
					house = {
						add_house_modifier = new_k_nanyue #南越皇族
					}
					title:e_celestia = { set_title_name = k_han }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_annan
					}
					house = {
						add_house_modifier = new_e_viet #大越皇族
					}
					title:e_celestia = { set_title_name = e_viet }
					title:e_celestia = { set_coa = title:k_annan }
					title:e_celestia = { set_color_from_title = title:k_annan }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_nanzhong
					}
					house = {
						add_house_modifier = new_e_dali #大礼皇族
					}
					title:e_celestia = { set_title_name = e_dali }
					title:e_celestia = { set_coa = title:k_nanzhong }
					title:e_celestia = { set_color_from_title = title:k_nanzhong }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_lanxang
					}
					house = {
						add_house_modifier = new_e_lanxang #大寮皇族
					}
					title:e_celestia = { set_title_name = e_lanxang }
					title:e_celestia = { set_coa = title:k_lanxang }
					title:e_celestia = { set_color_from_title = title:k_lanxang }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_goryeo
					}
					house = {
						add_house_modifier = new_k_goryeo #高丽皇族
					}
					title:e_celestia = { set_title_name = e_shang }
					title:e_celestia = { set_coa = title:e_goguryeo }
					title:e_celestia = { set_color_from_title = title:e_goguryeo }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_xia
						culture = { has_cultural_pillar = heritage_chinese }
					}
					house = {
						add_house_modifier = new_e_hexi #凉皇族
					}
					title:e_celestia = { set_title_name = e_hexi }
					title:e_celestia = { set_coa = title:k_xia }
					title:e_celestia = { set_color_from_title = title:k_xia }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_khitan
						any_held_title = { tier = tier_kingdom }
						NOT = { 
							has_title = title:k_jubu
						}
	
					}
					house = {
						add_house_modifier = new_e_grand_liao #大辽皇族
					}
					title:e_celestia = { set_title_name = e_grand_liao }
					title:e_celestia = { set_coa = title:k_liao }
					title:e_celestia = { set_color_from_title = title:k_liao }
				}
				else_if = {
					limit = {
						root.capital_province.kingdom = title:k_jubu
						any_held_title = { tier = tier_kingdom }
					}
					house = {
						add_house_modifier = new_e_yuan
					}
					title:e_celestia = { set_title_name = e_yuan }
					title:e_celestia = { set_coa = title:k_jubu }
					title:e_celestia = { set_color_from_title = title:k_jubu }
				}
				else_if = {
					limit = {
						NOT = { 
							any_held_title = { 
								tier = tier_kingdom 
							}
						}	
						root.capital_province.duchy = title:d_gewu
					}
					house = {
						add_house_modifier = new_k_goryeo #高丽皇族
					}
					title:e_celestia = { set_title_name = k_goryeo }
					title:e_celestia = { set_coa = title:k_goryeo }
					title:e_celestia = { set_color_from_title = title:k_goryeo }
				}
				else_if = {
					limit = {
						NOT = { 
							any_held_title = { 
								tier = tier_kingdom 
							}
						}	
						root.capital_province.duchy = title:d_rangnang
					}
					house = {
						add_house_modifier = new_k_liao #辽皇族
					}
					title:e_celestia = { set_title_name = k_liao }
					title:e_celestia = { set_coa = title:k_liao }
					title:e_celestia = { set_color_from_title = title:k_liao }
				}
	
				else_if = {
					limit = {						
						OR = {
							root.capital_province.duchy = title:d_chengde
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_chengde
							}
						}
					}
					house = {
						add_house_modifier = new_k_zhao #赵皇族
					}
					title:e_celestia = { set_title_name = e_zhao }
					title:e_celestia = { set_coa = title:d_chengde }
					title:e_celestia = { set_color_from_title = title:d_chengde }
				}
				else_if = {
					limit = {	
						OR = {
							root.capital_province.duchy = title:d_xingci
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_xingci
							}
						}
					}
					house = {
						add_house_modifier = new_k_zhao #赵皇族
					}
					title:e_celestia = { set_title_name = e_zhao }
					title:e_celestia = { set_coa = title:e_zhao }
					title:e_celestia = { set_color_from_title = title:d_xingci }
				}
				#else_if = {
				#	limit = {
				#		dynasty = dynasty:1000049854
				#	}
				#	if = {
				#		limit = { royal_members_trigger = no } ##非皇族
				#		house = {
				#			add_house_modifier = new_k_jin #晋皇族
				#		}
				#	}
				#	title:e_celestia = { set_title_name = k_jin }
				#	title:e_celestia = { set_coa = title:k_jin }
				#	title:e_celestia = { set_color_from_title = title:k_jin }
				#}
	
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_lulong
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_lulong
							}
						}
					}
					house = {
						add_house_modifier = new_k_yan #燕皇族
					}
					title:e_celestia = { set_title_name = k_yan }
					title:e_celestia = { set_coa = title:k_yan }
					title:e_celestia = { set_color_from_title = title:k_yan }
				}
				else_if = {
					limit = {
						NOT = { 
							has_title = title:k_wei
						}
						OR = {
							root.capital_province.duchy = title:d_weibo
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_weibo
							}
						}						
					}
					house = {
						add_house_modifier = new_k_wei #魏皇族
					}
					title:e_celestia = { set_title_name = k_wei }
					title:e_celestia = { set_coa = title:k_wei }
					title:e_celestia = { set_color_from_title = title:k_wei }
				}
				else_if = {
					limit = {	
						root.capital_province.duchy = title:d_henghai
					}
					house = {
						add_house_modifier = new_k_wei #魏皇族
					}
					title:e_celestia = { set_title_name = k_wei }
					title:e_celestia = { set_coa = title:k_wei }
					title:e_celestia = { set_color_from_title = title:k_wei }
				}
				else_if = {
					limit = {	
						root.capital_province.duchy = title:d_longxi
					}
					house = {
						add_house_modifier = new_e_qiang #大羌皇族
					}
					title:e_celestia = { set_title_name = e_qiang }
					title:e_celestia = { set_coa = title:k_xia }
					title:e_celestia = { set_color_from_title = title:k_xia }
				}
				else_if = {
					limit = {
						root.capital_province.duchy = title:d_longnan
					}
					house = {
						add_house_modifier = new_e_qiang #大羌皇族
					}
					title:e_celestia = { set_title_name = e_qiang }
					title:e_celestia = { set_coa = title:k_xia }
					title:e_celestia = { set_color_from_title = title:k_xia }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_shanzhou
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_shanzhou
							}
						}
					}
					house = {
						add_house_modifier = new_e_qiang #大羌皇族
					}
					title:e_celestia = { set_title_name = e_qiang }
					title:e_celestia = { set_coa = title:k_xia }
					title:e_celestia = { set_color_from_title = title:k_xia }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_pucao
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_pucao
							}
						}
					}
					house = {
						add_house_modifier = new_e_cao #曹皇族
					}
					title:e_celestia = { set_title_name = k_wei }
					title:e_celestia = { set_coa = title:d_pucao }
					title:e_celestia = { set_color_from_title = title:d_pucao }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_xusi
							root.capital_province.duchy = title:d_huainan
							root.capital_province.duchy = title:d_huaixi
							AND = {
								NOT = { exists = capital_province }
								OR = {
									root.location.duchy = title:d_xusi
									root.location.duchy = title:d_huainan
									root.location.duchy = title:d_huaixi
								}
							}
						}	
					}
					house = {
						add_house_modifier = new_e_xuu #徐皇族
					}
					title:e_celestia = { set_title_name = e_xuu }
					title:e_celestia = { set_coa = title:d_xusi }
					title:e_celestia = { set_color_from_title = title:d_xusi }
				}
				else_if = {
					limit = {							
						OR = {
							root.capital_province.duchy = title:d_zhenhai
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_zhenhai
							}
						}
					}
					house = {
						add_house_modifier = new_e_wuyue #吴越皇族
					}
					title:e_celestia = { set_title_name = e_wuyue }
					title:e_celestia = { set_coa = title:d_zhenhai }
					title:e_celestia = { set_color_from_title = title:k_yue }
				}
				else_if = {
					limit = {	
						OR = {
							root.capital_province.duchy = title:d_jiangxi
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_jiangxi
							}
						}
					}
					house = {
						add_house_modifier = new_e_gan #赣皇族
					}
					title:e_celestia = { set_title_name = e_gan }
					title:e_celestia = { set_coa = title:d_jiangxi }
					title:e_celestia = { set_color_from_title = title:d_jiangxi }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_hanzhong
							dynasty = dynasty:1000049855
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_hanzhong
							}
						}	
					}
					house = {
						add_house_modifier = new_e_han #汉皇族
					}
					title:e_celestia = { set_title_name = e_han }
					title:e_celestia = { set_coa = title:d_hanzhong }
					title:e_celestia = { set_color_from_title = title:e_han }
				}
				else_if = {
					limit = {
						OR = {
							root.capital_province.duchy = title:d_jingxiang
							root.capital_province.duchy = title:d_weisheng
							AND = {
								NOT = { exists = capital_province }
								root.location.duchy = title:d_jingxiang
							}
						}	
					}
					house = {
						add_house_modifier = new_e_sui #隋皇族
					}
					title:e_celestia = { set_title_name = e_sui }
					title:e_celestia = { set_coa = title:d_jingxiang }
					title:e_celestia = { set_color_from_title = title:d_jingxiang }
				}
				else_if = {
					limit = {
						root.capital_province.duchy = title:d_qiongya
					}
					house = {
						add_house_modifier = new_e_viet #大越皇族 #大越皇族
					}
					title:e_celestia = { set_title_name = e_viet }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
				else_if = {
					limit = {
						root.capital_province.duchy = title:d_rongguan
					}
					house = {
						add_house_modifier = new_cn_pu #雒皇族
					}
					title:e_celestia = { set_title_name = cn_pu }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
				else_if = {
					limit = {	
						root.capital_province.duchy = title:d_guiguan
					}
					house = {
						add_house_modifier = new_cn_pu #雒皇族
					}
					title:e_celestia = { set_title_name = cn_pu }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
				else_if = {
					limit = {
						root.capital_province.duchy = title:d_yongguan
					}
					house = {
						add_house_modifier = new_cn_pu #雒皇族
					}
					title:e_celestia = { set_title_name = cn_pu }
					title:e_celestia = { set_coa = title:k_nanyue }
					title:e_celestia = { set_color_from_title = title:k_nanyue }
				}
	
				else_if = {
					limit = {	
						root.capital_province.duchy = title:d_jiaozhi
					}
					house = {
						add_house_modifier = new_e_viet #大越皇族
					}
					title:e_celestia = { set_title_name = e_viet }
					title:e_celestia = { set_coa = title:k_annan }
					title:e_celestia = { set_color_from_title = title:k_annan }
				}
				else_if = {
					limit = {
						root.capital_province.duchy = title:d_jiuzhen
					}
					house = {
						add_house_modifier = new_e_viet #大越皇族
					}
					title:e_celestia = { set_title_name = e_viet }
					title:e_celestia = { set_coa = title:k_annan }
					title:e_celestia = { set_color_from_title = title:k_annan }
				}
				else_if = {
					limit = {
						root.capital_province.county = title:c_qianzhong
					}
					house = {
						add_house_modifier = new_cn_xie
					}
					title:e_celestia = { set_title_name = cn_xie }
					title:e_celestia = { set_coa = title:k_qianzhong }
					title:e_celestia = { set_color_from_title = title:k_qianzhong }
				}

				#文化绑定国号
				else_if = {
					limit = {	culture = { has_name_list = name_list_khitan } }
					house = { add_house_modifier = cn_liao }
					title:e_celestia = { set_title_name = cn_liao }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_jurchen } }
					house = { add_house_modifier = cn_jin }
					title:e_celestia = { set_title_name = cn_jin }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_mongol } }
					house = { add_house_modifier = cn_yuan }
					title:e_celestia = { set_title_name = cn_yuan }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_balhae } }
					house = { add_house_modifier = cn_liao }
					title:e_celestia = { set_title_name = cn_liao }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_heishui } }
					house = { add_house_modifier = cn_qing }
					title:e_celestia = { set_title_name = cn_qing }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_tangut } }
					house = { add_house_modifier = cn_xia }
					title:e_celestia = { set_title_name = cn_xia }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_bai } }
					house = { add_house_modifier = cn_dalli }
					title:e_celestia = { set_title_name = cn_dalli }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_wuman } }
					house = { add_house_modifier = cn_cuan }
					title:e_celestia = { set_title_name = cn_cuan }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_min } }
					house = { add_house_modifier = cn_yin }
					title:e_celestia = { set_title_name = cn_yin }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_mon } }
					house = { add_house_modifier = cn_jiuli }
					title:e_celestia = { set_title_name = cn_jiuli }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_jiaozhi } }
					house = { add_house_modifier = cn_yue }
					title:e_celestia = { set_title_name = cn_yue }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_yi } }
					house = { add_house_modifier = cn_jiuli }
					title:e_celestia = { set_title_name = cn_jiuli }
				}
				else_if = {
					limit = {	culture = { has_name_list = name_list_goguryeo } }
					house = { add_house_modifier = e_shang }
					title:e_celestia = { set_title_name = e_shang }
				}
				
			}
		}
	}
}

kingdom_guohao_effects = {
	effect = {
		#魏赵
		if = {
			limit = {
				scope:title.tier >= tier_kingdom
				OR = {
					AND = {
						exists = scope:previous_holder
						NOR = {					
							scope:transfer_type = flag:inheritance
							root.house = scope:previous_holder.house
						}
					}
					scope:transfer_type = flag:created
				}
			}
			if = {
				limit = {
					OR = {
						scope:title = title:k_zhao
						scope:title = title:k_liang
					}
					OR = {
						root.capital_province.duchy = title:d_weibo
						dynasty = dynasty:1000049455
					}
				}
				scope:title = { set_title_name = k_wei }
				scope:title = { set_coa = title:k_wei }
				#scope:title = { set_color_from_title = title:k_wei }
			}
		}
		#吴齐
		if = {
			limit = {
				game_start_date >= 936.1.1
				game_start_date <= 956.1.1
				has_title = title:k_wu
				is_independent_ruler = yes
				scope:title.tier >= tier_kingdom
				is_ai = yes
			}
			title:k_wu = {
				set_title_name = k_wu
			}
			if = {
				limit = {
					dynasty = dynasty:qushan_xu_dyn
				}
				every_house_member = {
					set_house = house:house_nantang_li
				}
				set_house = house:house_nantang_li
			}
		}
		#入主中原洗法理
		if = {
			limit = {
				OR = {
					government_has_flag = government_is_ulus
					government_has_flag = government_is_tribal
				}
				has_title = title:e_cathay
				scope:title = title:e_celestia
			}
			title:k_yan = { set_de_jure_liege_title = title:e_cathay }
			title:d_yunzhong = { set_de_jure_liege_title = title:k_tengri }
		}
	}
}


#下克上
yamato_on_title_gain_effects = {
	effect = {		
		if = { #非继承获得头衔
			limit = {
				scope:title = {
					is_oe_noble_family_title = no
					is_landless_type_title = no
				}
				#current_date >= 900.1.1
				exists = capital_province
				capital_province = { geographical_region = world_asia_japan }
				top_liege = { has_title = title:k_yamato }
				NOT = { has_title = title:d_gosho }
				NOT = { government_has_flag = government_is_celestial }
				highest_held_title_tier < tier_kingdom
				liege = {
					OR = {
						government_has_flag = government_is_feudal
						government_has_flag = government_is_celestial
						government_has_flag = government_is_legion
					}
				}
				#NOT = { scope:title = title:k_yamato }				
				NOT = {
					root.house = scope:previous_holder.house
				}
				NOR = {
					scope:transfer_type = flag:created
					scope:transfer_type = flag:inheritance
					scope:transfer_type = flag:revoked
					scope:transfer_type = flag:granted
					scope:transfer_type = flag:stepped_down
					scope:transfer_type = flag:abdication
					scope:transfer_type = flag:election
					scope:transfer_type = flag:appointment
					scope:transfer_type = flag:appointment_succession
				}
				NOT = { has_trait = founding_monarch }
				NOT = { government_has_flag = government_is_legion }
			}
			change_government = legion_government
		}
		#摄政/宫廷头衔
		if = {
			limit = {
				is_adult = yes
				OR = {
					has_yamato_regency_title = yes
					has_trait = joko
				}
			}
			add_pressed_claim = title:k_yamato
		}
		#院政
		if = {
			limit = {
				scope:title = title:d_incho
			}
			add_pressed_claim = title:k_yamato
			if = {
				limit = {
					has_title = title:d_gosho
					exists = primary_heir
				}
				primary_heir = {
					get_title = title:d_gosho
				}
			}
		}
	}
}


zunhao_effects = {
	trigger = {
		scope:title = primary_title
		exists = scope:secondary_title
		primary_title.tier > scope:secondary_title.tier
		highest_held_title_tier >= tier_county
		is_ai = no
		OR = {
			government_has_flag = government_is_tribal
			government_has_flag = government_is_ulus
		}
	}
	effect = {
		trigger_event = nianhao.2
	}
}

#被俘退位
on_imprison = {
	on_actions = {
		oe_imprison_empiror
	}
}

oe_imprison_empiror = {
	effect = {
		if = {
			limit = {
				is_oe_imperial_government_trigger = yes
			}
			trigger_event = {
				id = abdication.0001
				days = { 300 1000 }
			}
		}
	}
}

#女真入侵
on_war_won_attacker = {
	on_actions = {
		jurchen_incident_effects
	}
}

jurchen_incident_effects = {
	trigger = {
		current_year > 1100
		scope:war = {
			using_cb = steppe_war
		}
	}
	effect = {
		jurchen_incident_effect = yes
	}
}


on_title_destroyed = {
	on_actions = {
		destroy_fake_empire_effects
		destroy_titular_title_effects
	}
}
destroy_titular_title_effects = {
	trigger = {
		scope:landed_title = {
			has_variable = titular_title
		}
	}
	effect = {
		scope:landed_title.var:titular_title = {
			save_scope_as = title_from
		}
		scope:title_from = {
			if = {
				limit = {
					has_variable = titular_granted
				}
				remove_variable = titular_granted
			}
		}
	}
}

destroy_fake_empire_effects = {
	trigger = {
		OR = {
			has_primary_title = title:e_celestia
			has_primary_title = title:e_cathay
		}
		scope:landed_title = {
			is_head_of_faith = no
			tier = tier_empire
			OR = {
				is_titular = yes
				is_landless_type_title = yes
			}
		}
	}
	effect = {
		scope:landed_title = {
			every_claimant = {
				remove_claim = prev
			}
		}
		add_prestige = 1000
		dynasty = {
			add_dynasty_prestige = 1200
		}
	}
}

on_death = {
	on_actions = {
		story_on_death
	}
}

story_on_death = {
	effect = {
		if = {
			limit = {
				game_start_date = 925.11.14 #如梦令
				liege = title:e_celestia.holder
				exists = scope:killer
			}
			title:e_celestia.holder = {
				trigger_event = {
					on_action = chinese_revolt_events_on_action
				}
				every_powerful_vassal = {
					add_opinion = {
						target = prev
						modifier = executed_close_relation_opinion
					}
					trigger_event = {
						on_action = chinese_revolt_events_on_action
					}	
				}		
			}
		}
		if = {
			limit = { has_title = title:d_incho } #销毁院厅
			destroy_title = title:d_incho
		}
	}
}

story_on_start = {
	effect = {
		#历史摄政
		#燕云台
		if = {
			limit = { game_start_date = 975.1.7 } 
			character:194330 = {
				designate_diarch = character:1413617
				start_diarchy = regency
				set_diarchy_swing = 80
				add_hook = {
					type = predecessor_loyalty_hook
					target = character:1413617
					years = historic_regent_loyal_after_death_hook_duration_years_char_214_value
				}
			}
		}
		#清平乐
		if = {
			limit = { game_start_date = 1032.10.26 } 
			character:217724 = {
				if = {
					limit = {
						NOT = { character:huayang_liu_006 = { is_courtier_of = prev } }
					}
					add_courtier = character:huayang_liu_006
				}
				designate_diarch = character:huayang_liu_006
				start_diarchy = regency
				set_diarchy_swing = 80
				add_hook = {
					type = predecessor_loyalty_hook
					target = character:huayang_liu_006
					years = historic_regent_loyal_after_death_hook_duration_years_char_214_value
				}
			}
			character:3096 = {
				designate_diarch = character:additional_fatimids_1
				start_diarchy = regency
			}	
		}
		#洞仙歌
		if = {
			limit = { game_start_date = 1089.7.1 } 
			character:217727 = {
				if = {
					limit = {
						NOT = { character:mengcheng_gao_033 = { is_courtier_of = prev } }
					}
					add_courtier = character:mengcheng_gao_033
				}
				designate_diarch = character:mengcheng_gao_033
				start_diarchy = regency
				set_diarchy_swing = 80
				add_hook = {
					type = predecessor_loyalty_hook
					target = character:mengcheng_gao_033
					years = historic_regent_loyal_after_death_hook_duration_years_char_214_value
				}
			}
		}
		#如梦令
		if = {
			limit = { game_start_date = 925.11.14 } 			
			character:194325 = {
				add_realm_law_skip_effects = tribal_authority_3
			}
			character:1407169 = {
				designate_diarch = character:qushan_xu_003
				start_diarchy = regency
				set_diarchy_swing = 80
			}
			character:1412318 = {
				add_realm_law_skip_effects = imperial_bureaucracy_2
				remove_trait = diligent
				remove_trait = ambitious
				add_trait = lazy
				add_trait = content
				add_trait = lifestyle_reveler
				add_trait_xp = {
					trait = lifestyle_reveler
					value = {
						integer_range = {
							min = medium_lifestyle_random_xp_low
							max = medium_lifestyle_random_xp_high
						}
					}
				}


				designate_diarch = character:1400807
				start_diarchy = regency
				set_diarchy_swing = 40
				add_character_modifier = {
					modifier = investing_in_music_modifier
					years = 15
				}
				random_courtier = {
					#limit = { is_lowborn = yes }
					save_temporary_scope_as = court_musician
				}
				appoint_court_position = {
					recipient = scope:court_musician
					court_position = court_musician_court_position
				} 
				random_courtier = {
					#limit = { is_lowborn = yes }
					save_temporary_scope_as = court_jester
				}
				appoint_court_position = {
					recipient = scope:court_jester
					court_position = court_jester_court_position
				}

				every_held_title = {
					limit = { tier = tier_county }
					
					random = {
						chance = 25
						add_county_modifier = county_corruption_deserting_levies_modifier
						change_county_control = -30
					}
					random = {
						chance = 25
						change_county_control = -30
						add_county_modifier = county_corruption_lack_of_courts_modifier
					}
					random = {
						chance = 25
						change_county_control = -30
						add_county_modifier = county_corruption_lack_of_courts_modifier
					}
					random = {
						chance = 25
						change_county_control = -30
					}
				}
				every_powerful_vassal = {
					random_held_county = {
						change_county_control = -30
						add_county_modifier = county_corruption_deserting_levies_modifier
						add_county_modifier = county_corruption_lack_of_courts_modifier
					}
				}
			}
			#李吉吉杀郭崇韬
			#character:1412334 = {		
				#add_opinion = {
					#target = character:1401816
					#modifier = insult_opinion
					#opinion = -50
				#}
				#start_scheme = {
					#type = murder
					#target = character:1401816
				#}
			#}
			character:1400807 = {
				add_opinion = {
					modifier = set_me_aside_opinion
					target = character:1401816
				}
				start_scheme = {
					type = murder
					target = character:1401816
				}
			}
			character:1401816 = {
				add_realm_law_skip_effects = legion_succession_law
				set_designated_heir_unsafe =  character:longgang_meng_06
				set_variable = {
					name = oe_heir
					value = character:longgang_meng_06
				}
			}
		}
		#天净沙
		if = {
			limit = { game_start_date = 936.9.15 } 			
			character:1407169 = {
				designate_diarch = character:1406215
				start_diarchy = DaSiMa
				set_diarchy_swing = 80
			}
		}
		
		#陌上花
		if = {
			limit = {
				game_start_date = 947.2.1
			}
			every_ruler = {
				limit = {
					is_powerful_vassal = yes
					liege = title:e_celestia.holder
				}
				add_pressed_claim = title:e_celestia
			}
		}
		#满江红
		if = {
			limit = { game_start_date = 1134.5.26 }
			character:zhuojun_zhao_292 = {
				set_realm_capital = title:c_hangzhou
				set_location = {
					location = title:c_hangzhou.title_province
					stick_to_location = yes
				}
				domicile ?= { move_domicile = title:c_hangzhou.title_province }
			}
		}
		#望海潮
		if = {
			limit = { game_start_date = 1161.9.8 }
			character:zhuojun_zhao_292 = {
				set_realm_capital = title:c_hangzhou
				set_location = {
					location = title:c_hangzhou.title_province
					stick_to_location = yes
				}
				domicile ?= { move_domicile = title:c_hangzhou.title_province }
			}
			character:206657 = {
				designate_diarch = character:1404804
				start_diarchy = regency
				set_diarchy_swing = 80
			}
			character:nha_ly_033 = {
				designate_diarch = character:viet_to_0001
				start_diarchy = regency
				set_diarchy_swing = 80
			}
		}
		#水龙吟
		if = {
			limit = { game_start_date = 1178.10.1 }
			character:zhuojun_zhao_545 = {
				set_realm_capital = title:c_hangzhou
				set_location = {
					location = title:c_hangzhou.title_province
					stick_to_location = yes
				}
				domicile ?= { move_domicile = title:c_hangzhou.title_province }
			}
			character:nha_ly_041 = {
				designate_diarch = character:viet_to_0001
				start_diarchy = regency
				set_diarchy_swing = 80
			}
			character:shanyin_lu_045 = {
				add_character_modifier = {
					modifier = cat_lover_modifier
				}
				add_character_modifier = {
					modifier = cat_ill_modifier
				}
			}
		}
		#大和五摄家
		every_ruler = {
			limit = {
				has_yamato_regency_title = yes
				NOT = { has_title = title:k_yamato }
			}
			add_pressed_claim = title:k_yamato
		}
		
		title:d_gosho = {
			if = { limit = { exists = holder holder = { NOT = { has_title = title:k_yamato } } } holder = { add_pressed_claim = title:k_yamato } }			
		}
		title:d_kansai = {
			if = { limit = { exists = holder holder = { NOT = { has_title = title:k_yamato } } } holder = { add_pressed_claim = title:k_yamato } }			
		}
		title:d_incho = {
			if = { limit = { exists = holder holder = { NOT = { has_title = title:k_yamato } } } holder = { add_pressed_claim = title:k_yamato } }			
		}
		title:d_sekke = {
			if = { limit = { exists = holder holder = { NOT = { has_title = title:k_yamato } } } holder = { add_pressed_claim = title:k_yamato } }			
		}
		title:d_shogunate = {
			if = { limit = { exists = holder holder = { NOT = { has_title = title:k_yamato } } } holder = { add_pressed_claim = title:k_yamato } }			
		}
	}
}

story_title_gain_effects = {
	trigger = {
		game_start_date >= 925.1.1
		game_start_date < 947.12.12 #如梦令
	}
	effect = {		
		if = {
			limit = { 
				game_start_date >= 925.1.1
				game_start_date < 947.12.12 #如梦令
			}
			if = {
				limit = {
					scope:transfer_type = flag:conquest
					scope:title = { tier = tier_empire }
					NOT = { scope:title = title:e_celestia }
					has_title = title:d_dianqian
				}
				destroy_title = scope:title
			}
			#枢密院入川
			if = {
				limit = {
					scope:transfer_type = flag:conquest
					scope:title = title:k_shu
					root = character:1401816
					title:d_dianqian.holder ?= character:1401816					
					liege = title:e_celestia.holder
				}

				#唐皇子谋杀西蜀军头
				title:e_celestia.holder.primary_heir = {
					start_scheme = {
						type = murder
						target = title:d_dianqian.holder
					}
				}
				title:e_celestia.holder.primary_spouse = {
					start_scheme = {
						type = murder
						target = title:d_dianqian.holder
					}
				}
				title:e_celestia.holder = {
					random_close_family_member = {
						start_scheme = {
							type = murder
							target = title:d_dianqian.holder
						}
					}
				}
			}
			##移交河东军
			if = {
				limit = {
					scope:transfer_type = flag:inheritance
					OR = {
						scope:title = title:d_dianqian
						scope:title = title:d_longnan
						scope:title = title:k_shu
					}
					scope:previous_holder = character:1401816
					root = character:longgang_meng_06
					is_independent_ruler = no				
				}
				character:longgang_meng_06 = {
					liege = {
						save_temporary_scope_as = liege
					}
				}
				every_held_title = {
					limit = {
						NOT = { title_capital_county.title_province.kingdom = title:k_shu }
					}
					add_to_list = titles_to_take
				}
				every_vassal = {
					limit = {
						NOT = { capital_province.kingdom = title:k_shu }
					}
					add_to_list = vassal_to_take
				}
				create_title_and_vassal_change = {
					type = usurped
					save_scope_as = change
					add_claim_on_loss = no
				}
				every_in_list = {
					list = titles_to_take
					change_title_holder_include_vassals = {
						holder = scope:liege
						change = scope:change
						take_baronies = no
					}
				}
				every_in_list = {
					list = vassal_to_take
					change_liege = {
						liege = scope:liege
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}
	}
}